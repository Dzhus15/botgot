# üîß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –æ–ø–ª–∞—Ç–µ

## üìã –ü—Ä–æ–±–ª–µ–º–∞
–í–∞—à –±–æ—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–ª–∞—Ç–∞—Ö —á–µ—Ä–µ–∑ –Æ–ö–∞—Å—Å–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–≤–µ—Ä—à–∞—é—Ç –ø–ª–∞—Ç–µ–∂–∏, –Ω–æ –∫—Ä–µ–¥–∏—Ç—ã –Ω–µ –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## üîç –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã
1. **–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã webhook'–∏ –≤ –Æ–ö–∞—Å—Å–∞** - –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
2. **–û—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–ª–∞—Ç–µ–∂–µ–π** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
3. **–ü–ª–∞—Ç–µ–∂–∏ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## ‚úÖ –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á–∏
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –í Replit Secrets –¥–æ–±–∞–≤—å—Ç–µ:
YOOKASSA_API_KEY=your_api_key_here
YOOKASSA_SHOP_ID=your_shop_id_here
```

**–ì–¥–µ –Ω–∞–π—Ç–∏ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ:**
1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –Æ–ö–∞—Å—Å–∞: https://yookassa.ru/my
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí API –∫–ª—é—á–∏**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Shop ID** (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞)
   - **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** (API Key)

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook URL
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `utils/setup_webhooks.py`
2. –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É —Å `replit_url` (—Å—Ç—Ä–æ–∫–∞ 20)
3. –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ URL –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```python
# –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ:
replit_url = "https://your-repl-name.your-username.repl.co"

# –ù–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π URL, –Ω–∞–ø—Ä–∏–º–µ—Ä:
replit_url = "https://telegram-bot.your-username.repl.co"
```

**–ö–∞–∫ –Ω–∞–π—Ç–∏ –≤–∞—à URL:**
- –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à Repl –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –∏–∑ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
- –£–±–µ—Ä–∏—Ç–µ –≤—Å–µ –ø–æ—Å–ª–µ `.repl.co`

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É webhooks
–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
pip install aiohttp

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É webhooks
python utils/setup_webhooks.py
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
‚úÖ Webhook created for event: payment.succeeded
‚úÖ Webhook created for event: payment.canceled
‚úÖ Webhook created for event: payment.waiting_for_capture
‚úÖ Webhook created for event: refund.succeeded
üéâ All webhooks configured successfully!
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –Æ–ö–∞—Å—Å–∞
1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –Æ–ö–∞—Å—Å–∞
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí HTTP —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook'–∏ –¥–æ–±–∞–≤–∏–ª–∏—Å—å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º URL

### –®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ workflow
python main.py
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É webhook endpoint'–∞
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://your-app-url.repl.co/health`
–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: `OK`

### 2. –¢–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂
1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
2. –ü—Ä–æ—Å–ª–µ–¥–∏—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç:
   ```
   INFO - Received YooKassa webhook from IP: [IP]
   INFO - Processing YooKassa webhook: payment.succeeded
   INFO - YooKassa webhook processed successfully
   ```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
```bash
# –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
INFO - Payment processed successfully: user=123, payment_id=xxx, credits=10
```

## ‚ùó –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "Webhook creation error 400"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL webhook'–∞ - –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS

### –ü—Ä–æ–±–ª–µ–º–∞: "YooKassa credentials not configured"
**–†–µ—à–µ–Ω–∏–µ:** 
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –∫–ª—é—á–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Replit Secrets
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–ª–∞—Ç–µ–∂–∏ –≤—Å–µ –µ—â–µ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π email –≤ —á–µ–∫–µ** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä–æ–∫—É 68 –≤ `payment_api.py`
2. **–ü—Ä–æ–±–ª–µ–º—ã —Å 54-–§–ó** - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞
3. **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏

### –ü—Ä–æ–±–ª–µ–º–∞: Webhook'–∏ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤–∞—à Repl —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ –∑–∞—Å—ã–ø–∞–µ—Ç)
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ—Ä—Ç 5000 –æ—Ç–∫—Ä—ã—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ –∑–∞–ø—É—Å–∫–∞ webhook —Å–µ—Ä–≤–µ—Ä–∞

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ Repl
–î–æ–±–∞–≤—å—Ç–µ –≤ `main.py` keep-alive –º–µ—Ö–∞–Ω–∏–∑–º:
```python
# –£–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ - webhook server —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
Payment monitor —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–ª–∞—Ç–µ–∂–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥.

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞ –Ω–∞ –æ—à–∏–±–∫–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ environment variables —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ webhook URL –≤—Ä—É—á–Ω—É—é

**–í–∞–∂–Ω–æ:** –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook'–æ–≤ –ø–ª–∞—Ç–µ–∂–∏ –¥–æ–ª–∂–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫!